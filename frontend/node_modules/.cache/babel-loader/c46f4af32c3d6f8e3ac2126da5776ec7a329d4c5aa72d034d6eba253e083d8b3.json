{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useParams,useNavigate}from\"react-router-dom\";import\"./postDetailPage.css\";import Button from\"react-bootstrap/Button\";import{faBarChart}from\"@fortawesome/free-solid-svg-icons\";import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const PostDetailPage=_ref=>{let{loggedUser}=_ref;const navigate=useNavigate();const{id}=useParams();const[post,setPost]=useState();const[loading,setLoading]=useState(true);const[currentImageIndex,setCurrentImageIndex]=useState(0);useEffect(()=>{fetch(\"http://localhost:8080/api/posts/getPostById/\"+id,{//richiesta GET\nmethod:\"get\",headers:{\"Content-Type\":\"application/json\"}}).then(res=>{if(res.ok)return res.json();// Se la risposta è OK, converte i dati in JSON\nelse throw new Error(\"Connessione non riuscita\");}).then(res=>{setPost(res);// Aggiorna lo stato con i dati del post\nsetLoading(false);}).catch(error=>console.error(\"Error fetching: \",error));// Gestisce eventuali errori nella richiesta\n},[id]);// Effetto dipende da id, quindi viene rieseguito quando id cambia\nconst nextImage=()=>{// Funzione per passare all'immagine successiva\nsetCurrentImageIndex(prevIndex=>prevIndex===post.images.length-1?0:prevIndex+1);};const prevImage=()=>{// Funzione per tornare all'immagine precedente\nsetCurrentImageIndex(prevIndex=>prevIndex===0?post.images.length-1:prevIndex-1);};if(loading){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});}if(!post){return/*#__PURE__*/_jsx(\"div\",{children:\"Nessun post trovato\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"postDetailPage\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"imageContainer\",children:[post.images&&post.images.length>1&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:prevImage,className:\"prevButton\",children:\"Indietro\"}),/*#__PURE__*/_jsx(\"div\",{className:\"image\",children:/*#__PURE__*/_jsx(\"img\",{src:post.images[currentImageIndex],alt:\"\".concat(post.title)})}),/*#__PURE__*/_jsx(\"button\",{onClick:nextImage,className:\"nextButton\",children:\"Avanti\"})]}),post.images&&post.images.length===1&&/*#__PURE__*/_jsx(\"div\",{className:\"image\",children:/*#__PURE__*/_jsx(\"img\",{src:post.images[currentImageIndex],alt:\"\".concat(post.title)})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"infoImmobileContainer\",children:[/*#__PURE__*/_jsx(\"h1\",{children:post.title}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Citt\\xE0:\"}),\" \",post.city]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Tipo di annuncio: \"}),post.type]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Tipo di propriet\\xE0:\"}),\" \",post.property]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Bagni:\"}),\" \",post.bathroom]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Camere da letto:\"}),\" \",post.bedroom]}),/*#__PURE__*/_jsxs(\"h2\",{children:[\"Prezzo: \\u20AC\",post.price]}),/*#__PURE__*/_jsx(\"h3\",{children:\"Descrizione:\"}),/*#__PURE__*/_jsx(\"p\",{children:post.description}),/*#__PURE__*/_jsx(Button,{icon:faBarChart,className:\"chatButton\",disabled:loggedUser===\"\",onClick:e=>{const token=document.cookie.split(\"; \").find(row=>row.startsWith(\"token\")).split(\"=\")[1];fetch(\"http://localhost:8080/api/users/findUser\",{method:\"post\",headers:{\"Content-Type\":\"application/json\",\"Authorization\":token},body:JSON.stringify({id:id})}).then(res=>{if(res.ok)return res.json();else throw new Error(\"Problema di comunicazione\");}).then(res=>{if(res!==\"Stai aprendo una chat con te stesso\"&&res!==\"Utente non trovato\"&&res!==\"Post non trovato\"){fetch(\"http://localhost:8080/api/chats/addContact\",{method:\"post\",headers:{\"Content-Type\":\"application/json\",\"Authorization\":token},body:JSON.stringify({id:id,u1:loggedUser,u2:res})}).then(res=>{if(res.ok)return res.json();else throw new Error(\"Problema di comunicazione\");}).then(res=>{window.alert(res);navigate(\"/profilo\");}).catch(e=>{console.log(e);});}else window.alert(res);}).catch(e=>{console.log(e);});},children:\"Avvia chat\"})]})]});};export default PostDetailPage;","map":{"version":3,"names":["React","useEffect","useState","useParams","useNavigate","Button","faBarChart","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","PostDetailPage","_ref","loggedUser","navigate","id","post","setPost","loading","setLoading","currentImageIndex","setCurrentImageIndex","fetch","method","headers","then","res","ok","json","Error","catch","error","console","nextImage","prevIndex","images","length","prevImage","children","className","onClick","src","alt","concat","title","city","type","property","bathroom","bedroom","price","description","icon","disabled","e","token","document","cookie","split","find","row","startsWith","body","JSON","stringify","u1","u2","window","alert","log"],"sources":["C:/Users/lpaco/WebstormProjects/progetto finale/.progetto/frontend/src/pages/postDetailPage/PostDetailPage.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport \"./postDetailPage.css\";\r\nimport Button from \"react-bootstrap/Button\";\r\nimport { faBarChart } from \"@fortawesome/free-solid-svg-icons\";\r\n\r\nconst PostDetailPage = ({ loggedUser }) => {\r\n    const navigate = useNavigate();\r\n    const { id } = useParams();\r\n    const [post, setPost] = useState();\r\n    const [loading, setLoading] = useState(true);\r\n    const [currentImageIndex, setCurrentImageIndex] = useState(0);\r\n\r\n    useEffect(() => {\r\n        fetch(\"http://localhost:8080/api/posts/getPostById/\" + id, { //richiesta GET\r\n            method: \"get\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            }\r\n        })\r\n        .then(res => {\r\n            if(res.ok) return res.json(); // Se la risposta è OK, converte i dati in JSON\r\n            else throw new Error(\"Connessione non riuscita\");\r\n        })\r\n        .then((res) => {\r\n            setPost(res); // Aggiorna lo stato con i dati del post\r\n            setLoading(false);\r\n        }).catch(error => console.error(\"Error fetching: \", error)); // Gestisce eventuali errori nella richiesta\r\n    }, [id]); // Effetto dipende da id, quindi viene rieseguito quando id cambia\r\n\r\n    const nextImage = () => { // Funzione per passare all'immagine successiva\r\n        setCurrentImageIndex((prevIndex) =>\r\n            prevIndex === post.images.length - 1 ? 0 : prevIndex + 1\r\n        );\r\n    };\r\n\r\n    const prevImage = () => { // Funzione per tornare all'immagine precedente\r\n        setCurrentImageIndex((prevIndex) =>\r\n            prevIndex === 0 ? post.images.length - 1 : prevIndex - 1\r\n        );\r\n    };\r\n\r\n    if (loading) {\r\n        return <div>Loading...</div>;\r\n    }\r\n\r\n    if (!post) {\r\n        return <div>Nessun post trovato</div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"postDetailPage\">\r\n            <div className=\"imageContainer\">\r\n\r\n                {post.images && post.images.length > 1 && (\r\n                    <>\r\n                        <button onClick={prevImage} className=\"prevButton\">Indietro</button>\r\n                        <div className=\"image\">\r\n                            <img src={post.images[currentImageIndex]} alt={`${post.title}`} />\r\n                        </div>\r\n                        <button onClick={nextImage} className=\"nextButton\">Avanti</button>\r\n                    </>\r\n                )}\r\n                {post.images && post.images.length === 1 && (\r\n                    <div className=\"image\">\r\n                        <img src={post.images[currentImageIndex]} alt={`${post.title}`} />\r\n                    </div>\r\n                )}\r\n                \r\n            </div>\r\n            <div className=\"infoImmobileContainer\">\r\n                <h1>{post.title}</h1>\r\n                <p><strong>Città:</strong> {post.city}</p>\r\n                <p><strong>Tipo di annuncio: </strong>{post.type}</p>\r\n                <p><strong>Tipo di proprietà:</strong> {post.property}</p>\r\n                <p><strong>Bagni:</strong> {post.bathroom}</p>\r\n                <p><strong>Camere da letto:</strong> {post.bedroom}</p>\r\n                <h2>Prezzo: €{post.price}</h2>\r\n                <h3>Descrizione:</h3>\r\n                <p>{post.description}</p>\r\n                <Button icon={faBarChart} className=\"chatButton\" disabled={loggedUser === \"\"} onClick={e => { \r\n                        \r\n                        const token = document.cookie.split(\"; \")\r\n                        .find((row) => row.startsWith(\"token\"))\r\n                        .split(\"=\")[1];\r\n\r\n                        fetch(\"http://localhost:8080/api/users/findUser\", {\r\n                            method: \"post\",\r\n                            headers: {\r\n                                \"Content-Type\": \"application/json\",\r\n                                \"Authorization\": token\r\n                            },\r\n                            body: JSON.stringify({ id: id })\r\n                        }).then(res => {\r\n                            if(res.ok) return res.json();\r\n                            else throw new Error(\"Problema di comunicazione\");\r\n                        }).then(res => {\r\n                            if(res !== \"Stai aprendo una chat con te stesso\" && res !== \"Utente non trovato\" && res !== \"Post non trovato\"){\r\n                                fetch(\"http://localhost:8080/api/chats/addContact\", {\r\n                                    method: \"post\",\r\n                                    headers: {\r\n                                        \"Content-Type\": \"application/json\",\r\n                                        \"Authorization\": token\r\n                                    },\r\n                                    body: JSON.stringify({ \r\n                                        id: id,\r\n                                        u1: loggedUser,\r\n                                        u2: res\r\n                                    })\r\n                                }).then(res => {\r\n                                    if(res.ok) return res.json();\r\n                                    else throw new Error(\"Problema di comunicazione\");\r\n                                }).then(res => {\r\n                                    window.alert(res)\r\n                                    navigate(\"/profilo\");\r\n                                }).catch(e => { console.log(e); });\r\n                            } else window.alert(res)\r\n                            \r\n                        }).catch(e => { console.log(e); });\r\n                    }}>Avvia chat</Button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default PostDetailPage;\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}